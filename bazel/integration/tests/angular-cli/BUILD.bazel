load("//bazel/integration:index.bzl", "integration_test")

integration_test(
    name = "test",
    srcs = glob(["**/*"]),
    commands = [
        "yarn",
        "yarn ng build",
        "yarn ng test --no-watch",
    ],
    data = [
        # The Yarn files also need to be part of the integration test as runfiles
        # because the `yarn_bin` target is not a self-contained standalone binary.
        "@nodejs//:yarn_files",
    ],
    tags = [
        # Chromium cannot run in Sandbox. For this test, sandbox is disabled.
        # Additionally, we need to disable RBE as this test relies on internet
        # access for installing the NPM packages.
        "no-sandbox",
        "no-remote-exec",
    ],
    tool_mappings = {
        "@nodejs//:yarn_bin": "yarn",
        "@nodejs//:node_bin": "node",
    },
)
